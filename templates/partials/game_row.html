{% set is_tournament_game = game.id in tournament_game_ids %}

<tr id="game-row-{{ game.id }}" class="{% if game.is_shutout %}shutout{% endif %}">
    <td>
        {{ game.start_time.strftime('%Y-%m-%d %H:%M') }}
    </td>
    <td>
        <span class="badge bg-secondary">{{ game.game_type }}</span>
    </td>
    <td>
        <div class="small">
            <strong>Black Side:</strong>
            {% for gp in game.players if gp.team == 1 %}
                <span class="{% if gp.is_winner %}text-success fw-bold{% endif %}">{{ gp.player.name }}</span>{% if not loop.last %}, {% endif %}
            {% endfor %}
            <br>
            <strong>White Side:</strong>
            {% for gp in game.players if gp.team == 2 %}
                <span class="{% if gp.is_winner %}text-success fw-bold{% endif %}">{{ gp.player.name }}</span>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </div>
    </td>
    <td>
        <strong class="{% if game.team1_score > game.team2_score %}text-success{% elif game.team1_score < game.team2_score %}text-danger{% endif %}">
            {{ game.team1_score }}
        </strong>
        -
        <strong class="{% if game.team2_score > game.team1_score %}text-success{% elif game.team2_score < game.team1_score %}text-danger{% endif %}">
            {{ game.team2_score }}
        </strong>
    </td>
    <td>
        <div class="small">
            <strong>Black Side:</strong>
            {% for gp in game.players if gp.team == 1 %}
                <span class="{% if gp.elo_change > 0 %}text-success{% elif gp.elo_change < 0 %}text-danger{% endif %}">
                    {{ gp.player.name }}: {% if gp.elo_change > 0 %}+{% endif %}{{ gp.elo_change if gp.elo_change else '-' }}
                </span>{% if not loop.last %}, {% endif %}
            {% endfor %}
            <br>
            <strong>White Side:</strong>
            {% for gp in game.players if gp.team == 2 %}
                <span class="{% if gp.elo_change > 0 %}text-success{% elif gp.elo_change < 0 %}text-danger{% endif %}">
                    {{ gp.player.name }}: {% if gp.elo_change > 0 %}+{% endif %}{{ gp.elo_change if gp.elo_change else '-' }}
                </span>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </div>
    </td>
    <td>
        {% if game.duration_minutes %}
            <span class="game-duration">{{ game.duration_minutes }} min</span>
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>
    <td>
        {% if game.is_shutout %}
            <span class="badge bg-info text-dark">Shutout!</span>
        {% endif %}
    </td>
    <td class="text-end">
        {% if not is_tournament_game %}
        <button class="btn btn-sm btn-outline-primary"
                hx-get="/api/games/{{ game.id }}/edit-form"
                hx-target="#game-row-{{ game.id }}"
                hx-swap="outerHTML"
                title="Edit game">
            Edit
        </button>
        {% endif %}

        {% if game.audit_logs %}
        <button class="btn btn-sm btn-outline-secondary"
                hx-get="/api/games/{{ game.id }}/history"
                hx-target="#history-{{ game.id }}"
                hx-swap="innerHTML"
                title="View edit history">
            History
        </button>
        {% endif %}
    </td>
</tr>
{% if game.audit_logs %}
<tr id="history-{{ game.id }}">
    <td colspan="8"></td>
</tr>
{% endif %}
