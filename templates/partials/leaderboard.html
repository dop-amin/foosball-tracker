{% if players_stats %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Player</th>
                <th style="width: 120px;">Badges</th>
                <th>ELO Rating</th>
                <th>Games</th>
                <th>W-L</th>
                <th>Win Rate</th>
                <th>Goals</th>
                <th>+/-</th>
                <th>Shutouts</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in players_stats %}
            {% set actual_rank = rank_offset + loop.index %}
            <tr class="{% if actual_rank <= 3 %}winner{% endif %}">
                <td>
                    <strong>
                        {% if actual_rank == 1 %}ðŸ¥‡
                        {% elif actual_rank == 2 %}ðŸ¥ˆ
                        {% elif actual_rank == 3 %}ðŸ¥‰
                        {% else %}{{ actual_rank }}
                        {% endif %}
                    </strong>
                </td>
                <td><strong><a href="{{ url_for('pages.player_detail', player_id=stat.player.id) }}" class="text-decoration-none text-dark">{{ stat.player.name }}</a></strong></td>
                <td style="max-width: 120px;">
                    <div class="d-flex flex-wrap gap-1">
                        {% for badge in stat.badges %}
                        <span class="achievement-badge-icon"
                              data-bs-toggle="tooltip"
                              data-bs-placement="top"
                              title="{{ badge.label }}: {{ badge.tooltip }}">{{ badge.emoji }}</span>
                        {% endfor %}
                    </div>
                </td>
                <td><strong class="text-primary">{{ stat.elo_rating }}</strong></td>
                <td>{{ stat.total_games }}</td>
                <td>
                    <span class="text-success">{{ stat.wins }}</span>-<span class="text-danger">{{ stat.losses }}</span>
                </td>
                <td>
                    <div class="progress" style="height: 20px;">
                        <div class="progress-bar bg-success" role="progressbar" 
                             style="width: {{ stat.win_rate }}%" 
                             aria-valuenow="{{ stat.win_rate }}" 
                             aria-valuemin="0" aria-valuemax="100">
                            {{ "%.1f"|format(stat.win_rate) }}%
                        </div>
                    </div>
                </td>
                <td>{{ stat.goals_for }}/{{ stat.goals_against }}</td>
                <td class="{% if stat.goal_difference > 0 %}text-success{% elif stat.goal_difference < 0 %}text-danger{% endif %}">
                    {% if stat.goal_difference > 0 %}+{% endif %}{{ stat.goal_difference }}
                </td>
                <td>
                    <span class="badge bg-success text-white">{{ stat.shutouts_given }}</span> /
                    <span class="badge bg-danger text-white">{{ stat.shutouts_received }}</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% set hx_get = url_for('leaderboard.get_leaderboard') %}
{% set hx_params = {'min_games': min_games, 'game_type': game_type} %}
{% set hx_target = '#leaderboard-content' %}
{% include 'partials/pagination.html' %}

<small class="text-muted">
    <strong>Legend:</strong> +/- = Goal difference,
    Shutouts: <span class="badge bg-success text-white">Given</span> / <span class="badge bg-danger text-white">Received</span>
</small>
{% else %}
<p class="text-muted">No games played yet. Play some games to see the leaderboard!</p>
{% endif %}