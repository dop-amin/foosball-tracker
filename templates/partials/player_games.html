{% if games %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Teams</th>
                <th>Score</th>
                <th>Result</th>
                <th>ELO Change</th>
                <th>Duration</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for game in games %}
            {% set player_gp = game.players|selectattr('player_id', 'equalto', player.id)|first %}
            <tr class="{% if game.is_shutout %}shutout{% endif %}">
                <td>
                    {{ game.start_time.strftime('%Y-%m-%d %H:%M') }}
                </td>
                <td>
                    <span class="badge bg-secondary">{{ game.game_type }}</span>
                </td>
                <td>
                    <div class="small">
                        <strong>Team 1:</strong>
                        {% for gp in game.players if gp.team == 1 %}
                            <span class="{% if gp.is_winner %}text-success fw-bold{% endif %}{% if gp.player_id == player.id %}text-decoration-underline{% endif %}">
                                {{ gp.player.name }}
                            </span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                        <br>
                        <strong>Team 2:</strong>
                        {% for gp in game.players if gp.team == 2 %}
                            <span class="{% if gp.is_winner %}text-success fw-bold{% endif %}{% if gp.player_id == player.id %}text-decoration-underline{% endif %}">
                                {{ gp.player.name }}
                            </span>{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </div>
                </td>
                <td>
                    <strong class="{% if game.team1_score > game.team2_score %}text-success{% elif game.team1_score < game.team2_score %}text-danger{% endif %}">
                        {{ game.team1_score }}
                    </strong>
                    -
                    <strong class="{% if game.team2_score > game.team1_score %}text-success{% elif game.team2_score < game.team1_score %}text-danger{% endif %}">
                        {{ game.team2_score }}
                    </strong>
                </td>
                <td>
                    {% if player_gp.is_winner %}
                        <span class="badge bg-success">Won</span>
                    {% else %}
                        <span class="badge bg-danger">Lost</span>
                    {% endif %}
                </td>
                <td>
                    {% if player_gp.elo_change %}
                        <span class="{% if player_gp.elo_change > 0 %}text-success fw-bold{% elif player_gp.elo_change < 0 %}text-danger fw-bold{% endif %}">
                            {% if player_gp.elo_change > 0 %}+{% endif %}{{ player_gp.elo_change }}
                        </span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if game.duration_minutes %}
                        <span class="game-duration">{{ game.duration_minutes }} min</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if game.is_shutout %}
                        <span class="badge bg-warning text-dark">ðŸŽ‚ Shutout!</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<p class="text-muted mt-2">
    <small><strong>Legend:</strong> Underlined name indicates {{ player.name }}'s participation</small>
</p>
{% else %}
<p class="text-muted">{{ player.name }} hasn't played any games yet.</p>
{% endif %}
